# 测试策略与验收（对齐SOP）

文档版本: v1.0  
创建日期: 2025-09-03  
作者: 架构助手  
审核人: 待定

## 1. 测试金字塔
```
                /\
               /  \
              / E2E \           (10%)
             /______\
            /  集成  \          (20%)
           /________\
          /   单元    \         (70%)
         /__________\
```

## 2. 范围与优先级
- 单元：ViewModel/UseCase/Repository/Utils
- 集成：下载分块+校验回滚、KWS命中事件、Bandit推荐回退
- E2E：首启→首卡→互动→奖励→下一卡；离线/弱网；家长门与时长

## 3. 测试用例（节选）
### 3.1 功能
- 打开App 3步内进入首卡（P0）
- 每卡1个互动点命中率≥98%（P0）
- 奖励发放与贴纸持久化（P0）
- 下载断点续传，校验失败自动回滚（P0）
- 家长门：长按+算术题验证（P0）
- 时长到达弹休息页且不可跳过（P0）

### 3.2 红色偏好
- prefer_color=red 时红色卡曝光≤60%（P1）
- 红卡完成率与非红卡差异≤±5%（P1）
- 错误提示不使用红色（P0）

### 3.3 AI能力
- KWS：再来一次/暂停/下一张/返回命中率≥95%（安静环境）（P1）
- 推荐：Bandit存在回退策略且可用（P0）
- 家长摘要：生成成功率≥99%，长度≤3句（P1）

## 4. 兼容与性能
- 设备：小屏/大屏/平板；Android 7/8/10/12/14
- 性能：冷启动≤2.5s；帧率≥55fps；内存峰值≤350MB；包体≤80MB

## 5. 自动化
- 单元：JUnit + MockK；覆盖率目标≥70%
- UI：Espresso/Compose Test；关键路径用例
- 集成：仪器化+本地假服务（下载、网关）
- CI：PR触发test、connectedAndroidTest、jacoco覆盖率校验

## 6. 测试数据与Mock
- 本地假数据：卡片JSON、下载包、LLM假返回（模板化）
- 网络：断网/弱网注入器；限速/丢包模拟

## 7. 验收标准（DoD）
- 功能：用户故事全通过；红色偏好与家长功能可控
- 质量：无P0/P1缺陷；崩溃率≤0.5%；ANR≤0.3%
- 性能：冷启动/帧率/内存/包体全部达标
- 合规：不上传语音/图像；家长门保护；无广告外跳

## 8. 报告与回归
- 报告：测试清单、缺陷列表、覆盖率、性能截图
- 回归：修复后全量自动化；核心E2E复跑

